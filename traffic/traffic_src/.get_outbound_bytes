#!/bin/bash -
# gets the counters from netstat for outbound traffic
#  Mandatory parameters: interface 
#  return:               number of bytes 
#
if [ $# -lt 1 ];
then
      exit 1
fi

u_name=`uname`
interface="$1"

  case "$u_name"
  in
    "FreeBSD")
	   OUTBOUND=`netstat -i -b -n -I "$interface" | awk '\
            BEGIN{\
            i=1;\
            sum=0;\
            }\
            {\
              if (NR == 1) {\
                      while(i<NF) {\
                          if ($i == "Obytes") {\
                           break;\
                          }\
                          i++;\
                       }\
               }\
              if (NR>1) {\
                if ($4 ~ /[0-9]*\.[0-9]*\.[0-9]*\.[0-9]*/) {\
                  sum=sum+$i;\
                }\
              }\
            }\
           END { print sum;}'`
      ;;
      
    "Linux") OUTBOUND=`ifconfig $interface | nawk '{if ($0 ~ /TX bytes:/) {if (match($0,"TX bytes:[0-9]*")) { pattern = substr($0,RSTART,RLENGTH); print pattern; }}}' | awk -F ':' '{print $2}'`   
    ;;
  
  esac
  if [[ ! -n "$OUTBOUND" ]];
  then
      exit 1
  fi
  echo "$OUTBOUND"